let e;var t;function i(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}(t=e||(e={}))[t.LEFT_L=0]="LEFT_L",t[t.T=1]="T",t[t.RIGHT_L=2]="RIGHT_L",t[t.LEFT_Z=3]="LEFT_Z",t[t.BAR=4]="BAR",t[t.SQUARE=5]="SQUARE",t[t.RIGHT_Z=6]="RIGHT_Z";class n{static initializeGameMap(e,t){const i=[];for(let n=0;n<t;n++){const t=[];for(let i=0;i<e;i++)t.push({x:-1,y:-1});i.push(t)}return i}}function r(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i(n,"imageSquareSize",24),i(n,"size",40),i(n,"framePerSecond",24),i(n,"gameSpeed",5),i(n,"whiteLinesThickness",4),i(n,"score",0);class s{constructor(e,t,i,n){this.squareCountX=e,this.squareCountY=t,this.gameMap=i,this.shapeType=n,r(this,"imageX",void 0),r(this,"imageY",void 0),r(this,"template",void 0),r(this,"x",0),r(this,"y",0);const s=this.getImagePoint(n);this.imageX=s.x,this.imageY=s.y,this.template=this.getTemplate(n),this.x=e/2}checkBottom(){for(let e=0;e<this.template.length;e++)for(let t=0;t<this.template.length;t++){if(0==this.template[e][t])continue;const i=this.getTruncatedPosition(),n=e+i.x,r=t+i.y;if(r+1>=this.squareCountY)return!1;if(-1!=this.gameMap[r+1][n].x)return!1}return!0}checkLeft(){for(let e=0;e<this.template.length;e++)for(let t=0;t<this.template.length;t++){if(0==this.template[e][t])continue;const i=this.getTruncatedPosition(),n=e+i.x,r=e+i.y;if(n-1<0)return!1;if(-1!=this.gameMap[r][n-1].x)return!1}return!0}checkRight(){for(let e=0;e<this.template.length;e++)for(let t=0;t<this.template.length;t++){if(0==this.template[e][t])continue;const i=this.getTruncatedPosition(),n=e+i.x,r=e+i.y;if(n+1>=this.squareCountX)return!1;if(-1!=this.gameMap[r][n+1].x)return!1}return!0}moveRight(){this.checkRight()&&(this.x+=1)}moveLeft(){this.checkLeft()&&(this.x-=1)}moveBottom(){this.checkBottom()&&(this.y+=1,n.score+=1)}changeRotation(){const e=[];for(let t=0;t<this.template.length;t++)e[t]=this.template[t].slice();const t=this.template.length;for(let e=0;e<t/2;e++){const i=e,n=t-1-e;for(let e=i;e<n;e++){const t=e-i,r=this.template[i][e];this.template[i][e]=this.template[e][n],this.template[e][n]=this.template[n][n-t],this.template[n][n-t]=this.template[n-t][i],this.template[n-t][i]=r}}for(let t=0;t<this.template.length;t++)for(let i=0;i<this.template.length;i++){if(0==this.template[t][i])continue;const n=this.getTruncatedPosition(),r=t+n.x,s=i+n.y;if(r<0||r>=this.squareCountX||s<0||s>=this.squareCountY)return this.template=e,!1}}getTruncatedPosition(){return{x:Math.trunc(this.x),y:Math.trunc(this.y)}}getImagePoint(t){switch(t){case e.LEFT_L:return{x:0,y:120};case e.T:return{x:0,y:96};case e.RIGHT_L:return{x:0,y:72};case e.LEFT_Z:return{x:0,y:48};case e.BAR:return{x:0,y:24};case e.SQUARE:return{x:0,y:0};case e.RIGHT_Z:return{x:0,y:48}}}getTemplate(t){switch(t){case e.LEFT_L:return[[0,1,0],[0,1,0],[1,1,0]];case e.T:return[[0,0,0],[1,1,1],[0,1,0]];case e.RIGHT_L:return[[0,1,0],[0,1,0],[0,1,1]];case e.LEFT_Z:return[[0,0,0],[0,1,1],[1,1,0]];case e.RIGHT_Z:return[[0,0,0],[1,1,0],[0,1,1]];case e.BAR:return[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]];case e.SQUARE:return[[1,1],[1,1]]}}}const a=document.getElementById("canvas"),o=document.getElementById("nextShapeCanvas"),l=document.getElementById("scoreCanvas"),h=document.getElementById("image"),c=a.getContext("2d"),m=o.getContext("2d"),u=l.getContext("2d"),g=a.width/n.size,f=a.height/n.size;let p=n.initializeGameMap(g,f);const d=[0,1,2,3,4,5,6];let y,T,x=!1;const v=()=>{const e=Math.floor(Math.random()*d.length);return new s(g,f,p,e)},S=()=>{if(console.log("hello"),!x)if(T.checkBottom())T.y+=1;else{for(let e=0;e<T.template.length;e++)for(let t=0;t<T.template.length;t++)0!=T.template[e][t]&&(p[T.getTruncatedPosition().y+t][T.getTruncatedPosition().x+e]={x:T.imageX,y:T.imageY});(()=>{for(let e=0;e<p.length;e++){const t=p[e];let i=!0;for(let e=0;e<t.length;e++)-1==t[e].x&&(i=!1);if(i){n.score+=1e3;for(let t=e;t>0;t--)p[t]=p[t-1];const t=[];for(let e=0;e<g;e++)t.push({x:-1,y:-1});p[0]=t}}})(),T=y,y=v(),T.checkBottom()||(x=!0),n.score+=100}},z=(e,t,i,n,r)=>{c.fillStyle=r,c.fillRect(e,t,i,n)},w=()=>{p=n.initializeGameMap(g,f),n.score=0,x=!1,T=v(),y=v()},L=()=>{c.clearRect(0,0,a.width,a.height),(()=>{z(0,0,a.width,a.height,"#bca0dc");for(let e=0;e<g+1;e++)z(n.size*e-n.whiteLinesThickness,0,n.whiteLinesThickness,a.height,"white");for(let e=0;e<f+1;e++)z(0,n.size*e-n.whiteLinesThickness,a.width,n.whiteLinesThickness,"white")})(),(()=>{for(let e=0;e<p.length;e++){const t=p[e];for(let i=0;i<t.length;i++)-1!=t[i].x&&c.drawImage(h,t[i].x,t[i].y,n.imageSquareSize,n.imageSquareSize,i*n.size,e*n.size,n.size,n.size)}})(),(()=>{for(let e=0;e<T.template.length;e++)for(let t=0;t<T.template.length;t++)0!=T.template[e][t]&&c.drawImage(h,T.imageX,T.imageY,n.imageSquareSize,n.imageSquareSize,Math.trunc(T.x)*n.size+n.size*e,Math.trunc(T.y)*n.size+n.size*t,n.size,n.size)})(),(()=>{m.fillStyle="#bca0dc",m.fillRect(0,0,o.width,o.height);for(let e=0;e<y.template.length;e++)for(let t=0;t<y.template.length;t++)0!=y.template[e][t]&&m.drawImage(h,y.imageX,y.imageY,n.imageSquareSize,n.imageSquareSize,n.size*e,n.size*t+n.size,n.size,n.size)})(),u.clearRect(0,0,l.width,l.height),u.font="64px Poppins",u.fillStyle="black",u.fillText(n.score.toString(),10,50),x&&(c.font="64px Poppins",c.fillStyle="black",c.fillText("Game Over!",10,a.height/2))};window.addEventListener("keydown",(e=>{37==e.keyCode?T.moveLeft():38==e.keyCode?T.changeRotation():39==e.keyCode?T.moveRight():40==e.keyCode&&T.moveBottom()})),document.getElementById("reset-button")?.addEventListener("click",(()=>{w()})),w(),setInterval(S,1e3/n.gameSpeed),setInterval(L,1e3/n.framePerSecond);